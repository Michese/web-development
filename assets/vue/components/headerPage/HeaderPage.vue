<template>
  <header class="header-page">
    <div class="header-page__container container">
      <router-link :to="linkToGeneralPage" class="header-page__logo logo">
        <svg width="46" height="60" viewBox="0 0 46 60" class="logo__img" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M38.7445 39.3289C38.5183 39.3289 38.3016 39.376 38.0801 39.3949C38.3063 38.0049 38.4571 37.8447 38.4853 36.3793C38.4995 36.2592 38.523 36.1414 38.5301 36.0165C38.1791 28.7109 29.3986 24.5268 19.5039 24.4373C9.60204 24.5221 0.823966 28.7085 0.470581 36.0142C0.477649 36.1508 0.508276 36.278 0.515343 36.41C0.515343 36.4053 0.515343 36.4053 0.515343 36.4053C0.80983 49.497 9.1874 59.9996 19.5039 59.9996C25.151 59.9996 30.2067 56.8332 33.684 51.8364C34.9232 53.2476 36.7208 54.1452 38.7468 54.1452C42.488 54.1452 45.5271 49.8504 45.5271 46.1068C45.5248 42.3633 42.488 39.3289 38.7445 39.3289ZM31.7899 41.0699C28.7531 42.8015 24.3288 43.9536 19.4144 43.9441C14.4952 43.9536 10.0685 42.8015 7.0294 41.0699C3.94553 39.3171 2.49194 37.1686 2.5155 35.2674C2.48959 33.3497 3.95024 31.2011 7.0294 29.4506C10.0709 27.7167 14.4976 26.5717 19.4144 26.5765C24.3264 26.5694 28.7531 27.7167 31.7899 29.4506C34.8738 31.2011 36.3344 33.3497 36.3085 35.2674C36.3321 37.1639 34.8738 39.3171 31.7899 41.0699ZM38.7445 50.47C37.3074 50.4676 36.1507 49.4711 35.7973 48.1494C36.2873 47.0869 36.7208 44.7098 37.0883 43.5531C37.5736 43.2421 38.1202 43.0088 38.7421 43.0018C40.4478 43.0088 41.8378 44.3965 41.8449 46.1068C41.8401 47.8243 40.4525 50.4676 38.7445 50.47ZM27.6412 32.4968C27.6435 32.4144 27.6411 32.3343 27.6317 32.2589C27.4927 31.1893 26.9815 30.4425 26.0721 29.9737C25.1722 29.5095 23.8646 29.3281 22.1755 29.4294C18.5073 29.6533 11.2488 33.7879 8.86465 35.3333C11.1216 37.0484 18.0432 40.7684 21.7114 41.282C23.3864 41.5176 24.7057 41.4375 25.6386 41.0487C26.5763 40.6506 27.1464 39.9438 27.3702 38.8954C27.3891 38.8177 27.3985 38.7376 27.3985 38.6575C27.4385 37.6916 26.6847 36.6903 25.4855 36.099L24.1474 35.4488L25.5303 34.8951C26.7765 34.4004 27.6058 33.4604 27.6412 32.4968ZM23.3251 34.9941L22.3734 35.3734L23.2922 35.8234C24.1191 36.2262 24.6374 36.9165 24.6091 37.5785C24.6068 37.635 24.602 37.6916 24.5903 37.7458C24.4324 38.469 24.0413 38.9543 23.3958 39.2276C22.755 39.4962 21.848 39.5504 20.6983 39.3902C18.1728 39.0368 13.1571 36.6126 11.6046 35.4346C13.2419 34.3721 18.4932 31.3919 21.0164 31.2388C22.1778 31.1705 23.0754 31.2953 23.695 31.6157C24.317 31.9361 24.6704 32.4473 24.7646 33.1871C24.774 33.2366 24.774 33.2955 24.774 33.3497C24.7481 34.0093 24.1827 34.6572 23.3251 34.9941ZM15.2491 17.1929C14.9923 16.3683 15.1572 15.3388 15.7203 14.6132C16.2763 13.8899 17.0396 13.4494 17.7911 13.1101C18.1964 12.9476 18.512 12.8274 18.8442 12.6602C19.1741 12.4929 19.4803 12.2997 19.7536 12.0853C20.3096 11.6566 20.6441 11.0723 20.6088 10.4009C20.5687 9.72943 20.2177 9.03444 19.7842 8.41248C19.7701 8.38657 19.7465 8.36772 19.7324 8.34416C19.7253 8.34887 19.7206 8.35594 19.7183 8.36065C19.3178 8.68577 18.7971 8.77058 18.4626 8.33945C18.3306 8.17218 18.2011 8.00962 18.0738 7.84471C17.4802 7.07669 16.8959 6.28511 16.4624 5.41342C15.9724 4.44044 15.6143 3.31432 15.9441 2.24003C16.3376 0.937219 17.85 -0.396219 19.2824 0.110299C20.1117 0.404786 20.7195 1.13276 21.1648 1.90549C21.8079 1.45552 22.5618 1.09506 23.3322 1.26233C24.1167 1.43431 24.3288 2.28479 24.3452 2.968C24.3641 3.79728 24.0602 4.65954 23.6785 5.38515C23.1956 6.3016 22.4959 7.07198 21.6148 7.61619C21.2095 7.86591 20.6182 7.74576 20.5263 7.22747C20.425 6.66441 20.8302 6.1626 21.2732 5.87754C21.2802 5.87282 21.2896 5.86576 21.2967 5.86104C21.2991 5.86104 21.2991 5.86105 21.3014 5.85869C21.3556 5.82571 21.4098 5.7833 21.3273 5.83749C21.3297 5.83513 21.3321 5.83513 21.3344 5.83277C21.4098 5.77859 21.4828 5.71969 21.5512 5.65844C21.5606 5.64666 21.5747 5.63488 21.5865 5.6231C21.6336 5.57363 21.6807 5.51944 21.7231 5.46761C21.7844 5.39693 21.8409 5.3239 21.8951 5.25087C21.9846 5.11187 22.0671 4.96816 22.1401 4.82209C22.159 4.7844 22.1802 4.74199 22.199 4.7043C22.2202 4.65718 22.2485 4.57944 22.2626 4.54645C22.3121 4.39568 22.3639 4.2449 22.3993 4.09412C22.404 4.07999 22.4087 4.0635 22.4111 4.04936C22.4205 3.99282 22.4299 3.93392 22.437 3.87974C22.4464 3.7855 22.4535 3.69362 22.4558 3.59703C22.4511 3.55933 22.4487 3.51457 22.4464 3.49101C22.437 3.43918 22.4299 3.38971 22.4181 3.33788C22.4134 3.33788 22.4134 3.33317 22.4087 3.33081C22.3946 3.3049 22.3804 3.27898 22.3639 3.25071C22.3545 3.24364 22.3474 3.23658 22.3404 3.23186C22.3333 3.22951 22.3286 3.22715 22.3239 3.22244C22.3027 3.22715 22.2791 3.22715 22.2603 3.22951C22.2461 3.23186 22.2297 3.23658 22.2108 3.24364C22.1943 3.24835 22.1778 3.25307 22.1613 3.25778C22.1001 3.28605 22.0435 3.31432 21.9846 3.3473C21.9305 3.37557 21.775 3.47923 21.7679 3.48159C21.7326 3.5075 21.6949 3.53106 21.6619 3.55933C21.4522 3.71482 21.252 3.88445 21.0635 4.06114C20.7619 4.33442 20.0316 4.53467 19.8125 4.03758C19.6075 3.57818 19.3578 3.1282 19.0515 2.73006C19.028 2.70179 18.9997 2.6688 18.9926 2.65702C18.9479 2.60755 18.9055 2.56043 18.8607 2.51567C18.7712 2.42615 18.6793 2.33662 18.578 2.25888C18.5309 2.22118 18.4814 2.18584 18.4296 2.15286C18.4131 2.14108 18.3683 2.11988 18.3448 2.10339C18.2623 2.06805 18.1846 2.03978 18.0974 2.01858C18.0974 2.01858 18.0974 2.01858 18.0951 2.01858C18.055 2.01858 18.0197 2.01622 17.9796 2.01858C17.9608 2.01858 17.9443 2.02329 17.9348 2.028C17.9278 2.028 17.9231 2.03036 17.9184 2.03271C17.883 2.05156 17.8383 2.07983 17.8218 2.08925C17.81 2.09868 17.7982 2.11046 17.7864 2.12459C17.7746 2.13166 17.7676 2.14815 17.7582 2.16464C17.7511 2.18584 17.7417 2.21176 17.7322 2.23532C17.7252 2.29422 17.7134 2.38138 17.711 2.41908C17.711 2.45206 17.7087 2.48269 17.7087 2.51567C17.7087 2.52509 17.7087 2.53216 17.7087 2.53687C17.7322 2.75597 17.7723 2.96565 17.8359 3.17768C17.843 3.21302 17.8547 3.24364 17.8642 3.27663C17.876 3.3049 17.8854 3.33788 17.8924 3.35201C17.9349 3.46274 17.9796 3.57582 18.0291 3.6842C18.2317 4.13182 18.4767 4.56295 18.7429 4.97758C19.1858 5.66079 19.6853 6.29924 20.1871 6.93769C20.3237 7.11438 20.2766 7.44656 20.2154 7.63975C20.1706 7.77639 20.1046 7.90361 20.0245 8.0214C20.0622 8.05674 20.107 8.08501 20.1423 8.12271C20.6842 8.71639 21.1954 9.42081 21.3321 10.3255C21.504 11.2513 20.9834 12.2125 20.3237 12.7591C19.6806 13.3292 18.8489 13.6944 18.1587 13.97C17.4802 14.2575 16.8417 14.6391 16.4177 15.1574C15.9771 15.6663 15.8357 16.3354 15.9606 17.0327C16.0855 17.7324 16.4247 18.4274 16.8299 19.0729C17.2304 19.7326 17.7322 20.338 18.2529 20.9294C16.9854 20.0176 15.7509 18.8632 15.2491 17.1929ZM21.3273 5.83749C21.3156 5.84455 21.3061 5.85162 21.2967 5.85869C21.2944 5.85869 21.2944 5.86104 21.292 5.86104C21.3273 5.83749 21.3109 5.84927 21.3273 5.83749ZM21.9705 9.37604C21.7867 9.98622 21.9846 10.6223 22.2603 11.1665C22.5053 11.6542 22.8328 12.1042 23.1673 12.5353C23.238 12.6295 23.311 12.7214 23.384 12.8133C23.5607 13.0418 23.8222 13.0088 24.039 12.8581C24.0837 12.9217 24.1379 12.9782 24.1756 13.0442C24.5125 13.5389 24.7717 14.0926 24.7929 14.6061C24.8094 15.1127 24.5596 15.5391 24.1262 15.8689C23.9141 16.0338 23.6762 16.1846 23.4194 16.3142C23.1555 16.4461 22.9152 16.5333 22.5854 16.6699C21.9799 16.9479 21.358 17.3013 20.9009 17.902C20.4392 18.4981 20.3072 19.3556 20.5263 20.0271C20.9457 21.3864 21.9564 22.284 22.9953 22.9908C22.1943 22.0343 21.4475 20.9623 21.2355 19.8669C21.0093 18.7572 21.8716 17.9656 22.9576 17.5322C23.4971 17.3107 24.1803 17.0115 24.701 16.5498C25.2381 16.0998 25.6716 15.2964 25.5208 14.5331C25.403 13.7886 24.9766 13.2209 24.5314 12.7544C24.463 12.6861 24.3806 12.6272 24.3052 12.5612C24.3311 12.5165 24.357 12.4764 24.3735 12.4293C24.4065 12.3186 24.4348 12.1301 24.357 12.0335C24.0743 11.673 23.794 11.3126 23.5442 10.9309C23.3911 10.6977 23.2545 10.4527 23.1414 10.2006C23.1155 10.1394 23.0872 10.0781 23.0636 10.0121C23.0589 10.0027 23.0542 9.98622 23.0495 9.96973C23.0448 9.95088 23.0401 9.93204 23.033 9.91554C23 9.79775 22.9741 9.6776 22.9623 9.55274C22.9576 9.54802 22.9576 9.54331 22.9576 9.54096C22.9576 9.51975 22.9576 9.50326 22.96 9.48442C22.96 9.46321 22.967 9.41845 22.9718 9.38076C22.9788 9.37133 22.9812 9.35484 22.9859 9.34306C22.993 9.33128 22.9977 9.32421 23 9.31479C23.0095 9.31008 23.0142 9.30537 23.0236 9.29594C23.033 9.29359 23.0589 9.27474 23.0778 9.26532C23.0801 9.26532 23.0848 9.26061 23.0872 9.26061C23.0966 9.25589 23.1037 9.25589 23.1155 9.25589C23.1367 9.25589 23.1602 9.25589 23.1791 9.25589H23.1814C23.2286 9.26532 23.2757 9.28416 23.3181 9.30537C23.3322 9.31244 23.3581 9.32421 23.3675 9.33128C23.3958 9.35249 23.4217 9.37133 23.45 9.39018C23.5065 9.43494 23.5584 9.48442 23.6055 9.53153C23.6338 9.5598 23.655 9.58807 23.6832 9.61399C23.688 9.62106 23.7044 9.6399 23.7186 9.6564C23.8906 9.88021 24.0296 10.1346 24.1474 10.3938C24.2699 10.6741 24.6845 10.5611 24.8518 10.4056C24.9625 10.3043 25.0709 10.21 25.1887 10.1229C25.2075 10.1064 25.2287 10.0922 25.2499 10.0781C25.2546 10.0734 25.3418 10.0192 25.3724 10.0027C25.4054 9.98386 25.4384 9.96973 25.4737 9.95324C25.4831 9.95088 25.4949 9.94617 25.4996 9.94382C25.5091 9.94146 25.5208 9.94146 25.5303 9.93675C25.542 9.93675 25.5538 9.93204 25.5656 9.93204C25.5703 9.93204 25.5727 9.93675 25.575 9.93675C25.5797 9.94146 25.5844 9.94382 25.5868 9.94617C25.5939 9.96031 25.6033 9.97915 25.6104 9.99093C25.6127 9.99565 25.6127 9.99565 25.6127 9.99565C25.6221 10.0239 25.6221 10.0522 25.6269 10.0805C25.6316 10.0946 25.6339 10.1229 25.6363 10.1441C25.6339 10.1912 25.6292 10.2454 25.6245 10.2996C25.6245 10.3302 25.6174 10.3632 25.6127 10.3985C25.6104 10.4032 25.608 10.4126 25.608 10.4221C25.5892 10.5092 25.5609 10.594 25.5279 10.6789C25.5208 10.7001 25.502 10.7425 25.4926 10.7707C25.4808 10.7919 25.4714 10.8155 25.4596 10.8343C25.4148 10.9168 25.3724 10.9969 25.3229 11.077C25.2947 11.1194 25.2593 11.1595 25.2287 11.1972C25.2004 11.2278 25.1769 11.2561 25.1463 11.2867C25.1392 11.2961 25.1321 11.2985 25.125 11.3055C25.0874 11.3409 25.045 11.3738 25.0025 11.4045C24.9931 11.4139 24.9813 11.421 24.9696 11.4327C24.7198 11.5882 24.4913 11.8733 24.5479 12.1913C24.5997 12.4811 24.9342 12.5471 25.1604 12.4081C25.6575 12.1042 26.0486 11.6683 26.3218 11.15C26.5386 10.7448 26.7106 10.2571 26.6964 9.79068C26.6894 9.40431 26.5692 8.92607 26.1287 8.83183C25.6975 8.7376 25.2711 8.93785 24.9083 9.18993C24.6586 8.75409 24.3146 8.34652 23.8482 8.1816C23.0448 7.89419 22.1967 8.64572 21.9705 9.37604ZM24.9861 11.4186C24.9837 11.421 24.9813 11.421 24.979 11.4233C25.0944 11.3409 25.0237 11.395 24.9861 11.4186Z"
          />
        </svg>
        <span class="logo__text maria">Чайная комната</span>
      </router-link>

      <template v-if="!!user">
        <div class="header-page__dropdown dropdown" v-clickoutside="closeDropDown">
          <span class="header-page__auth maria" @click="openDropDown = !openDropDown">
              Здравствуйте, {{ user.name }}
            </span>
          <svg
            width="45"
            height="45"
            viewBox="0 0 45 45"
            class="header-page__avatar header-page__avatar_auth"
            xmlns="http://www.w3.org/2000/svg"
            @click="openDropDown = !openDropDown"
          >
            <path
              d="M22.5 0C10.0934 0 0 10.0934 0 22.5C0 34.9066 10.0934 45 22.5 45C34.9066 45 45 34.9066 45 22.5C45 10.0934 34.9066 0 22.5 0ZM22.5 42.3633C11.5473 42.3633 2.63672 33.4527 2.63672 22.5C2.63672 11.5473 11.5473 2.63672 22.5 2.63672C33.4527 2.63672 42.3633 11.5473 42.3633 22.5C42.3633 33.4527 33.4527 42.3633 22.5 42.3633Z"
            />
            <path
              d="M22.5 23.7305C27.5886 23.7305 31.7285 19.5906 31.7285 14.502C31.7285 9.41335 27.5886 5.27344 22.5 5.27344C17.4114 5.27344 13.2715 9.41335 13.2715 14.502C13.2715 19.5906 17.4114 23.7305 22.5 23.7305ZM22.5 7.91016C26.1347 7.91016 29.0918 10.8672 29.0918 14.502C29.0918 18.1367 26.1347 21.0938 22.5 21.0938C18.8653 21.0938 15.9082 18.1367 15.9082 14.502C15.9082 10.8672 18.8653 7.91016 22.5 7.91016Z"
            />
            <path
              d="M37.323 29.4823C35.571 27.5026 33.0515 26.3672 30.4105 26.3672H14.5901C11.9491 26.3672 9.42956 27.5026 7.67764 29.4823L7.05273 30.1885L7.51908 31.0081C10.5792 36.3858 16.3197 39.7266 22.5003 39.7266C28.6809 39.7266 34.4214 36.3858 37.4816 31.008L37.948 30.1884L37.323 29.4823ZM22.5003 37.0898C17.6016 37.0898 13.0291 34.6116 10.3377 30.56C11.52 29.5623 13.0253 29.0039 14.5901 29.0039H30.4105C31.9753 29.0039 33.4806 29.5623 34.6629 30.56C31.9715 34.6116 27.399 37.0898 22.5003 37.0898Z"
            />
          </svg>
          <div class="dropdown__body" v-show="openDropDown">
            <router-link :to="link" class="dropdown__text" @click="closeDropDown">Добавить запись</router-link>
            <span class="dropdown__text" @click="clickLogout">Выйти</span>
          </div>
        </div>
      </template>
      <auth-modal v-else>
        <span class="header-page__auth maria">Вход/Регистрация</span>
        <svg width="45" height="45" viewBox="0 0 45 45" class="header-page__avatar" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M22.5 0C10.0934 0 0 10.0934 0 22.5C0 34.9066 10.0934 45 22.5 45C34.9066 45 45 34.9066 45 22.5C45 10.0934 34.9066 0 22.5 0ZM22.5 42.3633C11.5473 42.3633 2.63672 33.4527 2.63672 22.5C2.63672 11.5473 11.5473 2.63672 22.5 2.63672C33.4527 2.63672 42.3633 11.5473 42.3633 22.5C42.3633 33.4527 33.4527 42.3633 22.5 42.3633Z"
          />
          <path
            d="M22.5 23.7305C27.5886 23.7305 31.7285 19.5906 31.7285 14.502C31.7285 9.41335 27.5886 5.27344 22.5 5.27344C17.4114 5.27344 13.2715 9.41335 13.2715 14.502C13.2715 19.5906 17.4114 23.7305 22.5 23.7305ZM22.5 7.91016C26.1347 7.91016 29.0918 10.8672 29.0918 14.502C29.0918 18.1367 26.1347 21.0938 22.5 21.0938C18.8653 21.0938 15.9082 18.1367 15.9082 14.502C15.9082 10.8672 18.8653 7.91016 22.5 7.91016Z"
          />
          <path
            d="M37.323 29.4823C35.571 27.5026 33.0515 26.3672 30.4105 26.3672H14.5901C11.9491 26.3672 9.42956 27.5026 7.67764 29.4823L7.05273 30.1885L7.51908 31.0081C10.5792 36.3858 16.3197 39.7266 22.5003 39.7266C28.6809 39.7266 34.4214 36.3858 37.4816 31.008L37.948 30.1884L37.323 29.4823ZM22.5003 37.0898C17.6016 37.0898 13.0291 34.6116 10.3377 30.56C11.52 29.5623 13.0253 29.0039 14.5901 29.0039H30.4105C31.9753 29.0039 33.4806 29.5623 34.6629 30.56C31.9715 34.6116 27.399 37.0898 22.5003 37.0898Z"
          />
        </svg>
      </auth-modal>
    </div>
  </header>
</template>

<script lang="ts">
import { Options, Vue } from 'vue-class-component';
import { Inject, InjectReactive } from 'vue-property-decorator';
import AuthModal from '@/vue/components/authModal/AuthModal.vue';
import { routerEnum } from '@/enums';
import { TUser } from '@/types';
import SecurityApi from '@/api/SecurityApi';

@Options({
  name: 'HeaderPage',
  components: { AuthModal },
})
export default class HeaderPage extends Vue {
  @InjectReactive('user') readonly user!: TUser | null;
  @Inject() setUser!: (user: TUser | null) => void;

  openDropDown = false;

  get link(): string {
    return routerEnum.creatingPage;
  }

  get linkToGeneralPage(): string {
    return routerEnum.generalPage;
  }

  async clickLogout(): Promise<void> {
    const {
      data: { success },
    } = await SecurityApi.logout();
    if (success) this.setUser(null);
    this.closeDropDown();
  }

  closeDropDown(): void {
    if (this.openDropDown) this.openDropDown = false;
  }
}
</script>

<style lang="scss" scoped>
@import '/assets/css/media';
.header-page {
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  z-index: 5;
  background-color: var(--color-green);

  &__container {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 15px 15px 25px;
  }

  &__dropdown {
    display: flex;
    align-items: flex-end;
    cursor: pointer;
    &:hover .header-page__avatar {
      fill: var(--color-gray);
    }
    &:hover .header-page__auth {
      color: var(--color-gray);
    }
  }

  &__avatar {
    fill: var(--color-yellow);

    &:hover {
      fill: var(--color-gray);
    }
  }

  &__btn {
    cursor: pointer;
  }

  &__auth {
    display: none;
    color: var(--color-yellow);
    margin-right: 8px;
    cursor: pointer;

    &:hover {
      color: var(--color-gray);
    }
  }
}

.logo {
  display: flex;
  align-items: flex-end;

  &__img {
    fill: var(--color-yellow);
  }

  &__text {
    display: none;
    color: var(--color-yellow);
  }

  &:hover &__img {
    fill: var(--color-gray);
  }
  &:hover &__text {
    color: var(--color-gray);
  }
}

.dropdown {
  position: relative;

  &__body {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: absolute;
    padding: 10px 0;
    top: 105%;
    right: 0;
    background-color: var(--color-promo-bg);
    border: 0.3px solid var(--color-yellow);
  }

  &__text {
    padding: 5px;
    text-align: center;
    cursor: pointer;

    &:hover {
      color: var(--color-yellow);
    }
  }
}

@include media(sm) {
  .header-page {
    &__auth {
      display: inline;
    }

    &__avatar {
      display: none;
      &_auth {
        display: block;
      }
    }
  }

  .logo {
    &__img {
      margin-right: 12px;
    }

    &__text {
      display: inline;
    }
  }
}
</style>
